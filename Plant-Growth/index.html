<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Plant Growth Simulation</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 20px;
    }
    .controls-container {
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 500px;
    }
    .controls {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    .slider-label {
      margin-top: 2px;
      color: #1142F8;
      font-weight: 600;
    }
    /* Pots & Plants */
    .pot-container {
      display: flex;
      justify-content: space-around;
      width: 100%;
      max-width: 600px;
    }
    .pot {
      width: 150px;
      height: 350px;
      background-color: brown;
      position: relative;
      margin-top: 20px;
      overflow: hidden; /* So leaves don't stick out visually if they're large */
    }
    .plant {
      width: 20px;
      height: 20px;
      background-color: green;
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
    }
    /* Leaf images */
    .leaf {
      position: absolute;
      width: 15px;       /* Adjust as needed */
      height: auto;
      bottom: 0;         /* Will update dynamically in JS */
    }
    .leaf-left {
      right: 44.3%;
      transform-origin: 100% 50%;            /* Nudged a bit left of center */
      transform: rotate(150deg); /* A slight tilt, adjust as you like */
    }
    .leaf-right {
      left: 44.3%;
      transform-origin: 0% 50%;          /* Nudged a bit right of center */
      transform: rotate(-150deg);
    }
    .time {
      margin-top: 20px;
    }
    .height-records {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 160px;
      width: 100%;
      max-width: 600px;
    }
    .height-box {
      border: 1px solid #aaa;
      padding: 10px;
      min-width: 120px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>Plant Growth Simulation</h1>

  <div class="controls-container">
    <!-- Controls for Pot 1 -->
    <div class="controls">
      <label class="slider-label" for="temperature1">
        Temperature (°C) - Pot 1:
      </label>
      <input
        type="range"
        id="temperature1"
        min="0"
        max="50"
        step="1"
        value="25"
        oninput="temperatureValue1.textContent = this.value"
      />
      <span id="temperatureValue1">25</span>

      <label class="slider-label" for="humidity1">
        Humidity (%) - Pot 1:
      </label>
      <input
        type="range"
        id="humidity1"
        min="0"
        max="100"
        step="1"
        value="50"
        oninput="humidityValue1.textContent = this.value"
      />
      <span id="humidityValue1">50</span>

      <label class="slider-label" for="light1">
        Light (hours) - Pot 1:
      </label>
      <input
        type="range"
        id="light1"
        min="0"
        max="24"
        step="1"
        value="12"
        oninput="lightValue1.textContent = this.value"
      />
      <span id="lightValue1">12</span>
    </div>

    <!-- Controls for Pot 2 -->
    <div class="controls">
      <label class="slider-label" for="temperature2">
        Temperature (°C) - Pot 2:
      </label>
      <input
        type="range"
        id="temperature2"
        min="0"
        max="50"
        step="1"
        value="25"
        oninput="temperatureValue2.textContent = this.value"
      />
      <span id="temperatureValue2">25</span>

      <label class="slider-label" for="humidity2">
        Humidity (%) - Pot 2:
      </label>
      <input
        type="range"
        id="humidity2"
        min="0"
        max="100"
        step="1"
        value="50"
        oninput="humidityValue2.textContent = this.value"
      />
      <span id="humidityValue2">50</span>

      <label class="slider-label" for="light2">
        Light (hours) - Pot 2:
      </label>
      <input
        type="range"
        id="light2"
        min="0"
        max="24"
        step="1"
        value="12"
        oninput="lightValue2.textContent = this.value"
      />
      <span id="lightValue2">12</span>
    </div>
  </div>

  <button onclick="simulateGrowth()">Simulate Growth</button>
  <button onclick="resetSimulation()">Reset</button>
  <button id="pauseResumeBtn" onclick="togglePause()">Pause</button>

  <div class="pot-container">
    <div class="pot">
      <div class="plant" id="plant1"></div>
    </div>
    <div class="pot">
      <div class="plant" id="plant2"></div>
    </div>
  </div>

  <!-- This shows which day we're on -->
  <div class="time" id="time">Day: 0</div>

  <!-- Two boxes to display each plant's height -->
  <div class="height-records">
    <div class="height-box">
      <strong>Plant 1 Height</strong>
      <div id="heightDisplay1">5 cm</div>
    </div>
    <div class="height-box">
      <strong>Plant 2 Height</strong>
      <div id="heightDisplay2">5 cm</div>
    </div>
  </div>

  <script>
    /* ==============================
       Global Variables
    ============================== */
    let day = 0;
    let dayTimer = null;

    // Keep track of whether we're paused
    let isPaused = false;

    // Keep track of the animation frame IDs
    let animationId1 = null;
    let animationId2 = null;

    // Keep references to each plant's growth functions
    let growthFn1 = null;
    let growthFn2 = null;

    // We'll use these flags to stop growth loops when we reset
    let cancelGrowth1 = false;
    let cancelGrowth2 = false;

    // 1px ≈ 0.264583 mm
    const PX_TO_MM = 0.264583;

    // Leaf threshold — at which height do leaves appear?
    const LEAF_THRESHOLD = 40; // in px of the green shoot

    const timeDisplay = document.getElementById('time');
    const plant1 = document.getElementById('plant1');
    const plant2 = document.getElementById('plant2');

    /* ==============================
       Start Simulation
    ============================== */
    function simulateGrowth() {
      // Read current slider inputs
      const temp1 = document.getElementById('temperature1').value;
      const humidity1 = document.getElementById('humidity1').value;
      const light1 = document.getElementById('light1').value;

      const temp2 = document.getElementById('temperature2').value;
      const humidity2 = document.getElementById('humidity2').value;
      const light2 = document.getElementById('light2').value;

      // Reset everything
      resetSimulation();

      // After reset, allow new growth
      cancelGrowth1 = false;
      cancelGrowth2 = false;
      isPaused = false;

      // Grow each plant
      startGrowing(plant1, temp1, humidity1, light1, 'heightDisplay1', 1);
      startGrowing(plant2, temp2, humidity2, light2, 'heightDisplay2', 2);

      // Update the day counter each second
      updateDay();
    }

    /* ==============================
       Growth Logic
    ============================== */
    function startGrowing(plant, temp, humidity, light, displayId, plantNumber) {
      // Simple condition: if all are “ideal” range, use full rate; else half
      // Some base growth rate if everything is perfect
      const baseGrowthRate = 0.08;

      // Calculate stress factor for temperature
      // For example, if temp is 20..30, no stress => factor = 1
      // If temp is below 20, we lose 0.05 per degree
      // If temp is above 30, we lose 0.05 per degree
      function tempStress(temp) {
        if (temp >= 20 && temp <= 30) return 1;
        let distance = 0;
        if (temp < 20) distance = 20 - temp;
        else distance = temp - 30;
        // 0.05 is how severely each degree outside the ideal range affects growth
        const factor = 1 - distance * 0.05;
        return Math.max(factor, 0); // never go below zero
      }

      // Do the same for humidity, light, etc.
      function humidityStress(humidity) {
        // 40..60 => factor = 1
        // below 40 or above 60 => lose 0.01 for each point away
        if (humidity >= 40 && humidity <= 60) return 1;
        let distance = 0;
        if (humidity < 40) distance = 40 - humidity;
        else distance = humidity - 60;
        const factor = 1 - distance * 0.01;
        return Math.max(factor, 0);
      }

      function lightStress(light) {
        // 8..16 => factor = 1
        // outside => reduce 0.1 per hour
        if (light >= 8 && light <= 16) return 1;
        let distance = 0;
        if (light < 8) distance = 8 - light;
        else distance = light - 16;
        const factor = 1 - distance * 0.1;
        return Math.max(factor, 0);
      }

      // Then combine them in your growth logic:
      const tFactor = tempStress(temp);
      const hFactor = humidityStress(humidity);
      const lFactor = lightStress(light);

      // Multiply them together to get an overall stress factor
      const overallFactor = tFactor * hFactor * lFactor;

      // Final growth rate
      let growthRate = baseGrowthRate * overallFactor;


      // Start plant at 20px tall
      let height = 20;
      plant.style.height = height + 'px';

      // We also want to spawn leaves once, after crossing threshold
      // We'll store each "leaf set" in an array
      // Each entry: { leftEl, rightEl, spawnHeight }
      const leafSets = [];

      // We'll spawn the first set at LEAF_THRESHOLD, then every X px more
      let nextLeafSpawn = LEAF_THRESHOLD; // 40, from your code
      const leafSpawnGap = 35;           // spawn another set every +20px


      // We can get the pot element in which this plant is living
      const pot = plant.parentElement;

      // Define the "grow" function
      function grow() {
        // If reset was clicked or paused, don't schedule more frames
        if (
          (plantNumber === 1 && cancelGrowth1) ||
          (plantNumber === 2 && cancelGrowth2) ||
          isPaused
        ) {
          // Reset the animation ID so we know it's not running
          if (plantNumber === 1) animationId1 = null;
          if (plantNumber === 2) animationId2 = null;
          return;
        }

        // Increase plant height
        height += growthRate;
        plant.style.height = height + 'px';


          /************************************
           * 1) SPAWN NEW LEAF SET IF READY  *
           ************************************/
          // If our shoot is tall enough to spawn the next set:
          if (height >= nextLeafSpawn) {
            // Create left & right leaves
            const leftEl = document.createElement('img');
            leftEl.src = 'left-leaf.png';
            leftEl.className = 'leaf leaf-left';
            pot.appendChild(leftEl);

            const rightEl = document.createElement('img');
            rightEl.src = 'right-leaf.png';
            rightEl.className = 'leaf leaf-right';
            pot.appendChild(rightEl);

            // Record this new set’s spawn height
            leafSets.push({
              leftEl,
              rightEl,
              spawnHeight: height
            });

            // Schedule next spawn in +20px (or any gap you want)
            nextLeafSpawn += leafSpawnGap;
          }

          /****************************************
           * 2) MOVE AND GROW ALL EXISTING LEAVES *
           ****************************************/
          leafSets.forEach(leafSet => {
            // The shoot has grown (height) since these leaves spawned
            const extraHeight = Math.max(0, height - leafSet.spawnHeight);

            // Position them: place them at bottom = (current shoot top - an offset)
            // If you want them to appear exactly where they spawned, pick something like:
            //   leafBottom = (height - leafSet.spawnHeight) + (some offset)
            // For simplicity, let's do:
            const leafBottom = (height - 10) - (leafSet.spawnHeight - 20);
            // ^ You can adjust the math to place them exactly how/where you want.
            leafSet.leftEl.style.bottom = leafBottom + 'px';
            leafSet.rightEl.style.bottom = leafBottom + 'px';

            // Scale up the leaves as they move up
            let scaleFactor = 1 + extraHeight * 0.02;
            scaleFactor = Math.min(scaleFactor, 4);  // clamp to max size if you like

            leafSet.leftEl.style.transform = `rotate(150deg) scale(${scaleFactor})`;
            leafSet.rightEl.style.transform = `rotate(-150deg) scale(${scaleFactor})`;
          });

        // Convert height to mm
        const heightInMM = height * PX_TO_MM;
        const heightInInches = heightInMM * 0.393701;
        // We'll label this "cm," but strictly it's mm in your formula
        document.getElementById(displayId).textContent =
          heightInMM.toFixed(0) + ' cm (' + heightInInches.toFixed(0) + ' in)';

        // Simulate up to 60 days
        if (day < 60) {
          // Schedule the next frame
          if (plantNumber === 1) {
            animationId1 = requestAnimationFrame(grow);
          } else {
            animationId2 = requestAnimationFrame(grow);
          }
        }
      }

      // Store the grow function so we can resume later
      if (plantNumber === 1) {
        growthFn1 = grow;
      } else {
        growthFn2 = grow;
      }

      // Start growth
      grow();
    }

    /* ==============================
       Day Counter
    ============================== */
    function updateDay() {
      // Only increment day if not paused and not at 60 days yet
      if (!isPaused && day < 60) {
        day++;
        timeDisplay.textContent = 'Day: ' + day;
      }

      // Re-schedule the timer if still under 60 days
      if (day < 60) {
        dayTimer = setTimeout(updateDay, 1000);
      }
    }

    /* ==============================
       Reset Simulation
    ============================== */
    function resetSimulation() {
      // 1. Stop day updates
      if (dayTimer !== null) {
        clearTimeout(dayTimer);
        dayTimer = null;
      }
      day = 0;
      timeDisplay.textContent = 'Day: 0';

      // 2. Cancel any ongoing growth animations
      cancelGrowth1 = true;
      cancelGrowth2 = true;
      if (animationId1 !== null) {
        cancelAnimationFrame(animationId1);
        animationId1 = null;
      }
      if (animationId2 !== null) {
        cancelAnimationFrame(animationId2);
        animationId2 = null;
      }

      // 3. Reset plants visually
      plant1.style.height = '20px';
      plant2.style.height = '20px';

      // 4. Remove any existing leaves from both pots
      const pots = document.querySelectorAll('.pot');
      pots.forEach(pot => {
        const leaves = pot.querySelectorAll('.leaf');
        leaves.forEach(leaf => {
          pot.removeChild(leaf);
        });
      });

      // Convert 20px to mm, then “cm” and inches
      const initMM = 20 * PX_TO_MM;
      const initInch = initMM * 0.393701;

      document.getElementById('heightDisplay1').textContent =
        initMM.toFixed(0) + ' cm (' + initInch.toFixed(0) + ' in)';
      document.getElementById('heightDisplay2').textContent =
        initMM.toFixed(0) + ' cm (' + initInch.toFixed(0) + ' in)';
    }

    /* ==============================
       Toggle Pause/Resume
    ============================== */
    function togglePause() {
      const pauseBtn = document.getElementById("pauseResumeBtn");
      if (!isPaused) {
        // Currently running, so PAUSE
        isPaused = true;
        pauseBtn.textContent = "Resume";
      } else {
        // Currently paused, so RESUME
        isPaused = false;
        pauseBtn.textContent = "Pause";

        // If you still have days left and the plants are not canceled, resume them:
        if (day < 60) {
          if (!cancelGrowth1 && animationId1 === null && typeof growthFn1 === "function") {
            growthFn1(); // resume plant 1
          }
          if (!cancelGrowth2 && animationId2 === null && typeof growthFn2 === "function") {
            growthFn2(); // resume plant 2
          }
        }
      }
    }
  </script>
</body>
</html>
