<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cat vs Dog Neural Network Demo</title>

<style>
  :root{
    --bg:#0b0f19;
    --panel:#111a2e;
    --panel2:#0b1123;
    --border:#223057;
    --muted:#aeb9de;
    --text:#eaf0ff;
    --arrow:#8aa2ff88;
  }
  body{
    margin:0;
    font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial;
    background:var(--bg);
    color:var(--text);
  }
  header{
    padding:14px 16px;
    border-bottom:1px solid #1c2644;
    background:linear-gradient(180deg, #0c1222 0%, rgba(12,18,34,.2) 100%);
    position:sticky; top:0; z-index:5;
  }
  header h2{ margin:0; font-size:18px; }
  header p{ margin:6px 0 0; color:var(--muted); font-size:13px; line-height:1.35; }

  .stage{
    max-width:1200px;
    margin:0 auto;
    padding:16px;
    display:grid;
    grid-template-columns: 320px 1fr 280px;
    gap:100px;
    position:relative;
  }

  .card{
    background:linear-gradient(180deg, rgba(17,26,46,.95) 0%, rgba(15,22,40,.95) 100%);
    border:1px solid var(--border);
    border-radius:14px;
    padding:14px;
    position:relative;
    z-index:2;
  }

  /* LEFT */
  .imgbox{
    height:270px;
    border-radius:12px;
    border:1px dashed #2b3c6f;
    background:#070b14;
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:hidden;
  }
  .imgbox img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:none;
  }
  .placeholder{
    color:var(--muted);
    text-align:center;
    padding:12px;
    font-size:13px;
    line-height:1.35;
  }
  .btnrow{
    display:flex;
    gap:10px;
    margin-top:12px;
    flex-wrap:wrap;
  }
  button{
    padding:10px 12px;
    border-radius:12px;
    border:1px solid #2b3c6f;
    background:#0c1428;
    color:var(--text);
    font-weight:700;
    cursor:pointer;
  }
  button:hover{ border-color:#3a54a0; }

  /* MIDDLE */
  .middle{
    min-height: 610px;
  }
  .middle h3{
    margin:0 0 10px;
    font-size:14px;
    color:var(--muted);
    letter-spacing:.2px;
  }
  .feature{
    border:1px solid #24335d;
    background:var(--panel2);
    border-radius:14px;
    padding:12px;
    margin-bottom:10px;
    cursor:pointer;
    user-select:none;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
  }
  .feature.on{
    border-color:#3a54a0;
    background:linear-gradient(180deg, rgba(122,162,255,.18) 0%, rgba(11,17,35,.95) 100%);
  }
  .fname{
    font-weight:800;
    font-size:14px;
  }
  .fval{
    min-width:44px;
    text-align:center;
    border-radius:12px;
    padding:8px 10px;
    border:1px solid #2b3c6f;
    background:#0c1428;
    font-weight:900;
  }
  .weights{
    margin-top:12px;
    border-top:1px solid #1c2644;
    padding-top:12px;
  }
  .wrow{
    border:1px solid #24335d;
    background:var(--panel2);
    border-radius:14px;
    padding:10px;
    margin-bottom:10px;
  }
  .wrow .title{
    font-weight:800;
    font-size:13px;
    margin-bottom:8px;
  }
  .sliderRow{
    display:flex;
    gap:20px;
    flex-wrap:nowrap;
  }

  .sliderRow > div{
    flex:1;
    min-width:0;   /* prevents wrapping */
  }

  .slider{
    font-size:12px;
    color:var(--muted);
  }
  .slider .top{
    display:flex;
    align-items:center;
    justify-content:space-between;
    margin-bottom:4px;
  }
  input[type="range"]{
    width:100%;
    accent-color:#7aa2ff;
  }

  /* RIGHT */
  .right{
    min-height: 610px;
  }
  .right h3{
    margin:0 0 10px;
    font-size:14px;
    color:var(--muted);
    letter-spacing:.2px;
  }
  .outbox{
    border:1px solid #24335d;
    background:var(--panel2);
    border-radius:14px;
    padding:12px;
  }
  .choice{
    border:1px solid #2b3c6f;
    background:#0c1428;
    border-radius:14px;
    padding:14px;
  }
  /* Make CAT and DOG farther apart vertically */
  .choice.dog{
    margin-top:220px; /* <-- vertical separation */
  }
  .choice .big{
    font-size:20px;
    font-weight:950;
    letter-spacing:.3px;
  }
  .choice .score{
    margin-top:6px;
    color:var(--muted);
    font-weight:750;
    font-size:13px;
  }
  .pred{
    margin-top:14px;
    font-size:16px;
    font-weight:900;
  }
  .tiny{
    margin-top:8px;
    color:var(--muted);
    font-size:12px;
    line-height:1.35;
  }

  /* SVG overlay for arrows */
  .arrows{
    position:absolute;
    inset:0;
    z-index:1;
    pointer-events:none;
  }

  button.step{
    width:30px;
    height:30px;
    border-radius:10px;
    border:1px solid #2b3c6f;
    background:#0c1428;
    color:var(--text);
    font-weight:900;
    cursor:pointer;
    line-height:1;
  }
  button.step:hover{ border-color:#3a54a0; }


  @media (max-width: 980px){
    .stage{ grid-template-columns: 1fr; }
    .arrows{ display:none; }
    .choice.dog{ margin-top:20px; }
  }
</style>
</head>

<body>
<header>
  <h2>Cat vs Dog Neural Network (5 Features)</h2>
  <p>
    Click <b>Try</b> to load a random photo. Click features ON/OFF (Present or Absent). Move sliders to change arrow thickness (weights), for Dogs or Cats. See how different hidden features' weights change over time for dog or cat.
  </p>
</header>

<div class="stage" id="stage">
  <!-- SVG arrows overlay -->
  <svg class="arrows" id="svg" aria-hidden="true">
    <defs>
      <marker id="arrowHead" markerWidth="10" markerHeight="10" refX="8" refY="5" orient="auto" markerUnits="userSpaceOnUse">
        <path d="M0,0 L10,5 L0,10 z" fill="var(--arrow)"></path>
      </marker>
    </defs>
  </svg>

  <!-- LEFT -->
  <div class="card">
    <div class="imgbox">
      <img id="photo" alt="Random cat or dog photo">
      <div class="placeholder" id="placeholder">
        Press <b>Try</b> to load an image.
      </div>
    </div>
    <div class="btnrow">
      <button id="btnTry">Try (Random Photo)</button>
      <button id="btnReset">Reset</button>
    </div>
    <div class="tiny">
      Feature values are 0/1 (OFF/ON). Weights can be negative (meaning “this feature votes against that output”).
      Arrow thickness uses <code>|weight|</code>.
    </div>
  </div>

  <!-- MIDDLE -->
  <div class="card middle" id="middle">
    <h3>Hidden Layer (Features)</h3>
    <div id="features"></div>

    <div class="weights">
      <h3>Weights (feature → CAT / feature → DOG)</h3>
      <div class="tiny" style="margin-bottom:10px;">Move the dials. Watch the arrows change thickness.</div>
      <div id="weights"></div>
    </div>
  </div>

  <!-- RIGHT -->
  <div class="card right" id="right">
    <h3>Output Layer</h3>
    <div class="outbox">
      <div class="choice cat" id="catBox">
        <div class="big">CAT</div>
      </div>

      <div class="choice dog" id="dogBox">
        <div class="big">DOG</div>

      </div>

    </div>
  </div>
</div>

<script>
  const TOTAL_PHOTOS = 10;

  const FEATURES = [
    {key:"whiskers",  title:"Has Whiskers"},
    {key:"blackNose", title:"Has Black Nose"},
    {key:"tongue",    title:"Shows Tongue"},
    {key:"pointyEar", title:"Has Pointy Ear"},
    {key:"roundEyes", title:"Has Round Eyes"},
  ];

  const values = {};
  const weights = {};
  FEATURES.forEach(f=>{
    values[f.key]=0;
    weights[f.key]={cat:0,dog:0};
  });

  const stage = document.getElementById("stage");
  const svg = document.getElementById("svg");

  const featuresDiv = document.getElementById("features");
  const weightsDiv = document.getElementById("weights");

  const catScoreEl = 0;
  const dogScoreEl = 0;
  const predEl = "none";

  const catBox = document.getElementById("catBox");
  const dogBox = document.getElementById("dogBox");

  function buildUI(){
    // Feature boxes
    FEATURES.forEach(f=>{
      const box = document.createElement("div");
      box.className="feature";
      box.id="feat-"+f.key;
      box.innerHTML = `
        <div class="fname">${f.title}</div>
        <div class="fval" id="val-${f.key}">0</div>
      `;
      box.addEventListener("click", ()=>{
        values[f.key] = values[f.key] ? 0 : 1;
        box.classList.toggle("on", values[f.key]===1);
        document.getElementById("val-"+f.key).textContent = values[f.key];
        update();
      });
      featuresDiv.appendChild(box);
    });

    // Weight sliders
    FEATURES.forEach(f=>{
      const row = document.createElement("div");
      row.className="wrow";
      row.innerHTML = `
        <div class="title">${f.title}</div>

        <div class="sliderRow">
          <div class="slider">
            <div class="top"><span>→ CAT</span><span id="wcat-${f.key}">0</span></div>
            <div style="display:flex; gap:8px; align-items:center;">

              <button type="button" class="step" data-step="-1" data-target="cat-${f.key}">−</button>
              <input type="range" min="-5" max="5" step="1" value="0" id="cat-${f.key}">
              <button type="button" class="step" data-step="1" data-target="cat-${f.key}">+</button>
            </div>
          </div>

          <div class="slider">
            <div class="top"><span>→ DOG</span><span id="wdog-${f.key}">0</span></div>
            <div style="display:flex; gap:8px; align-items:center;">
  
              <button type="button" class="step" data-step="-1" data-target="dog-${f.key}">−</button>
              <input type="range" min="-5" max="5" step="1" value="0" id="dog-${f.key}">
              <button type="button" class="step" data-step="0.5" data-target="dog-${f.key}">+</button>
            </div>
          </div>
        </div>

      `;
      weightsDiv.appendChild(row);

      const catSlider = row.querySelector("#cat-"+f.key);
      const dogSlider = row.querySelector("#dog-"+f.key);
      row.querySelectorAll("button.step").forEach(btn => {
        btn.addEventListener("click", () => {
          const targetId = btn.dataset.target;
          const step = Number(btn.dataset.step);
          const slider = row.querySelector("#" + CSS.escape(targetId));

          const min = Number(slider.min);
          const max = Number(slider.max);
          const stepSize = Number(slider.step) || 0.5;

          // Move by button step, then snap to slider step
          let v = Number(slider.value) + step;
          v = Math.max(min, Math.min(max, v));
          v = Math.round(v / stepSize) * stepSize;

          slider.value = v;
          slider.dispatchEvent(new Event("input", { bubbles:true }));
        });
      });

      catSlider.addEventListener("input", ()=>{
        weights[f.key].cat = Number(catSlider.value);
        row.querySelector("#wcat-"+f.key).textContent = catSlider.value;
        update();
      });
      dogSlider.addEventListener("input", ()=>{
        weights[f.key].dog = Number(dogSlider.value);
        row.querySelector("#wdog-"+f.key).textContent = dogSlider.value;
        update();
      });
    });
  }

  function compute(){
    let cat=0, dog=0;
    FEATURES.forEach(f=>{
      cat += values[f.key]*weights[f.key].cat;
      dog += values[f.key]*weights[f.key].dog;
    });
    return {cat, dog};
  }

  function update(){
    const {cat, dog} = compute();
    catScoreEl.textContent = cat.toFixed(2);
    dogScoreEl.textContent = dog.toFixed(2);

    if (cat === dog) predEl.textContent = "Tie";
    else predEl.textContent = (cat > dog) ? "CAT" : "DOG";

    // subtle highlight
    catBox.style.borderColor = (cat > dog) ? "#44d17a" : "#2b3c6f";
    dogBox.style.borderColor = (dog > cat) ? "#44d17a" : "#2b3c6f";

    drawArrows();
  }

  // ---- SVG ARROWS ----
  function centerOf(el, container){
    const r = el.getBoundingClientRect();
    const c = container.getBoundingClientRect();
    return { x: (r.left - c.left) + r.width/2, y: (r.top - c.top) + r.height/2 };
  }

  function clearSvg(){
    const defs = svg.querySelector("defs");
    svg.innerHTML = "";
    svg.appendChild(defs);
  }

  function resetHiddenValuesOnly(){
    FEATURES.forEach(f=>{
      values[f.key] = 0;
  
      // update the displayed 0 in the feature box
      const vEl = document.getElementById("val-"+f.key);
      if (vEl) vEl.textContent = "0";
  
      // if you added Yes/No buttons, clear their highlight too
      const featBox = document.getElementById("feat-"+f.key);
      if (featBox) {
        featBox.classList.remove("on"); // harmless if unused
        featBox.querySelectorAll("button.yn").forEach(b => b.classList.remove("onBtn"));
      }
    });
  
    update(); // redraw arrows etc.
  }

  
  function strokeWidthFromWeight(w){
    // w in [-5, 5] → width in [1, 10]
    return 1 + ((w + 5) / 10) * 19;
  }

  function addArrow(x1,y1,x2,y2,width){
    const line = document.createElementNS("http://www.w3.org/2000/svg","line");
    line.setAttribute("x1", x1);
    line.setAttribute("y1", y1);
    line.setAttribute("x2", x2);
    line.setAttribute("y2", y2);
    line.setAttribute("stroke", "var(--arrow)");
    line.setAttribute("stroke-width", String(width));
    line.setAttribute("marker-end", "url(#arrowHead)");
    line.setAttribute("stroke-linecap", "round");
    svg.appendChild(line);
  }

  function edgePoint(el, container, side){
    const r = el.getBoundingClientRect();
    const c = container.getBoundingClientRect();
    const left   = r.left - c.left;
    const top    = r.top  - c.top;
    const right  = left + r.width;
    const bottom = top + r.height;
    const midY   = top + r.height/2;
    const midX   = left + r.width/2;

    if (side === "right") return { x: right, y: midY };
    if (side === "left")  return { x: left,  y: midY };
    if (side === "top")   return { x: midX,  y: top };
    return { x: midX, y: bottom }; // bottom
  }



  function drawArrows(){
    clearSvg();
    svg.setAttribute("width", stage.clientWidth);
    svg.setAttribute("height", stage.clientHeight);

    const container = stage;

    // end points: LEFT edge of CAT/DOG boxes
    const catEnd = edgePoint(catBox, container, "left");
    const dogEnd = edgePoint(dogBox, container, "left");

    FEATURES.forEach((f) => {
      const featEl = document.getElementById("feat-"+f.key);
      if (!featEl) return;

      // start point: RIGHT edge of each feature box
      const start = edgePoint(featEl, container, "right");

      // small vertical separation so the two arrows don’t overlap perfectly
      const dy = 6;

      // IMPORTANT: add some horizontal gap so arrow head isn't buried inside the output box border
      const catX = catEnd.x - 6;
      const dogX = dogEnd.x - 6;

      addArrow(start.x + 6, start.y - dy, catX, catEnd.y, strokeWidthFromWeight(weights[f.key].cat));
      addArrow(start.x + 6, start.y + dy, dogX, dogEnd.y, strokeWidthFromWeight(weights[f.key].dog));
    });
  }

  // ---- IMAGES ----
  document.getElementById("btnTry").addEventListener("click", ()=>{
    const idx = Math.floor(Math.random()*TOTAL_PHOTOS)+1;
    const src = `photo${idx}.jpg`;
    const img = document.getElementById("photo");
    const placeholder = document.getElementById("placeholder");

    img.src = src;
    img.onload = ()=>{
      img.style.display="block";
      placeholder.style.display="none";
      resetHiddenValuesOnly();
    };
    img.onerror = ()=>{
      img.style.display="none";
      placeholder.style.display="block";
      placeholder.innerHTML = `Could not load <b>${src}</b>. Put photos in the same folder as this HTML file.`;
    };
  });

  document.getElementById("btnReset").addEventListener("click", ()=>{
    // Reset values and weights without reloading the page like a caveman.
    FEATURES.forEach(f=>{
      values[f.key]=0;
      weights[f.key]={cat:0,dog:0};

      const feat = document.getElementById("feat-"+f.key);
      feat.classList.remove("on");
      document.getElementById("val-"+f.key).textContent="0";

      const catSlider = document.getElementById("cat-"+f.key);
      const dogSlider = document.getElementById("dog-"+f.key);
      catSlider.value = 0;
      dogSlider.value = 0;
      document.getElementById("wcat-"+f.key).textContent = "0";
      document.getElementById("wdog-"+f.key).textContent = "0";
    });

    catBox.style.borderColor="#2b3c6f";
    dogBox.style.borderColor="#2b3c6f";
    update();
  });

  window.addEventListener("resize", ()=>drawArrows());

  // INIT
  buildUI();
  update();
</script>
</body>
</html>
